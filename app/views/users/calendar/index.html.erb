<div class="min-h-screen bg-gradient-to-br from-sky-50 to-blue-50 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-sky-800 mb-2">ğŸ“… äºˆç´„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
      <p class="text-sky-600">äºˆç´„çŠ¶æ³ã®ç¢ºèªã¨æ–°è¦äºˆç´„</p>
    </div>

    <!-- æ–°è¦äºˆç´„ãƒœã‚¿ãƒ³ -->
    <div class="text-center mb-6">
      <%= link_to "æ–°è¦äºˆç´„ã‚’ä½œæˆ", new_users_reservation_path, 
          class: "inline-flex items-center px-6 py-3 bg-sky-500 hover:bg-sky-600 text-white font-medium rounded-lg transition-colors duration-200" %>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <div id="calendar" class="w-full"></div>
    </div>


  </div>
</div>

<!-- FullCalendar CSS -->
<link href='https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.18/main.min.css' rel='stylesheet' />
<link href='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.18/main.min.css' rel='stylesheet' />
<link href='https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.18/main.min.css' rel='stylesheet' />

<!-- FullCalendar JavaScript -->
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.18/main.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.18/main.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@6.1.18/main.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.18/main.min.js'></script>

<script>
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’varã§å®£è¨€ï¼ˆå†å®£è¨€ã‚¨ãƒ©ãƒ¼ã‚’é˜²ãï¼‰
var calendar = null;

// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–ã™ã‚‹é–¢æ•°
function initializeCalendar() {
  var calendarEl = document.getElementById('calendar');
  if (!calendarEl) return;
  
  // æ—¢å­˜ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒã‚ã‚Œã°ç ´æ£„
  if (calendar) {
    calendar.destroy();
  }
  
  calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    locale: 'ja',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek'
    },
    buttonText: {
      today: 'ä»Šæ—¥',
      month: 'æœˆ',
      week: 'é€±'
    },
    dayMaxEvents: true,
    events: function(info, successCallback, failureCallback) {
      // äºˆç´„æ¸ˆã¿ã®ã‚¹ãƒ­ãƒƒãƒˆã‚’è¡¨ç¤º
      fetch(`/users/calendar/slots/${info.startStr.split('T')[0]}`)
        .then(response => response.json())
        .then(data => {
          var events = [];
          data.forEach(function(slot) {
            if (!slot.available) {
              events.push({
                title: 'äºˆç´„æ¸ˆã¿',
                start: slot.start_time,
                end: slot.end_time,
                backgroundColor: '#ef4444',
                borderColor: '#ef4444',
                textColor: 'white'
              });
            }
          });
          successCallback(events);
        })
        .catch(error => {
          console.error('Error fetching events:', error);
          failureCallback(error);
        });
    }
  });
  calendar.render();
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
function initializePage() {
  initializeCalendar();
}

// DOMContentLoadedã¨turbo:loadã®ä¸¡æ–¹ã«å¯¾å¿œ
document.addEventListener('DOMContentLoaded', initializePage);
document.addEventListener('turbo:load', initializePage);
</script> 